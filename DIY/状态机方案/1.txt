



套接字对于TCP的API：

Connect
Listen
send
Recv
Bind
Accept




->prvTCP_CheckSumRx() -> prvTCP_SN_ACK_Rx() -> prvTCP_OptionWinsizeRx() -> prvTCP_DataRx() -> prvTCP_StateMachine() 

prvTCP_FlagsRx()

    if CurState == Listen:
        if RxFlags != SYN:return;
    if == SYNRECV:
        if RxFlags != ACK:return;
    if == SYNSENT:
        if RxFlags != SYN+ACK:return;

prvTCP_SN_ACK_Rx()
    已告知对方我们自己的SN号
    if LocalSN_Informed && RxACK != LocalSN:return;
    if RemoteSN_Knowed && RxSn != RemoteSN:return;
    if !RemoteSN_Knowed:RemoteSN = RxSN;RemoteSN_Knowed = 1;

prvTCP_OptionWinsizeRx()

    processOption()
    ProcessWinSize()

prvTCP_DataRx()

    getData()
    if DataLen != 0;RemoteSN += DataLen;

prvTCP_StateMachine()

    if == Closed:
        CurState = SYNSENT;
    if == Listen:
        CurState = SYNRECV;
        Respond = 1;
        break;
    if == SYNRECV:
        CurState = ESTABLISHED;
        Respond = 0;
        break;
    if == SYNSENT:
        CurState = ESTABLISHED;
        Respond = 1;
    if Respond:启动如下一系列流程

prvTCP_DataTx()

    SetData()

prvTCP_OptionWinsizeRx()

    SetOption()
    SetWinSize()

prvTCP_SN_ACK_Tx()

    if CurState < ESTABLISHED:
        TxSN = LocalSN;LocalSN += 1;
        if RemoteSN_Knowed:TxACK = RemoteSN;RemoteSN += 1;
    if ActiveSYN && CurState == ESTABLISHED:
        
    if DataLenTx :TxSN = LocalSN;LocalSN += DataLenTx;
    if !LocalSN_Informed:LocalSN_Informed = 1;
        
prvTCP_FlagsTx()

    if CurState == SYNSENT:TxFlags |= SYN;
    if CurState == SYNRECV:TxFlags |= SYN+ACK;


